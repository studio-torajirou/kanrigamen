<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>ã‚¹ã‚¿ã‚¸ã‚ªå¯…æ¬¡éƒ äºˆç´„ç®¡ç†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script>
    // GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURL
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbwzn7oJAsoc20JyOw77EjbYwWCHHj1DBkIqrCreacNu-KX5l5k8Gx3JEZTlow7P9I3K6g/exec";

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
    const ADMIN_PASSWORD = "0126"; 
  </script>

  <style>
    /* â–¼â–¼â–¼ GitHubç”¨ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ â–¼â–¼â–¼ */
    #authOverlay {
      position: fixed; inset: 0; z-index: 9999;
      background: #fff0f5; 
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.3s;
    }
    .auth-box {
      background: #ffffff; padding: 40px; border-radius: 24px;
      box-shadow: 0 8px 24px rgba(233, 30, 99, 0.1);
      text-align: center; width: 90%; max-width: 400px;
    }
    .auth-title { font-size: 24px; font-weight: bold; color: #442c2e; margin-bottom: 20px; }
    .auth-input { 
      font-size: 24px; padding: 12px; width: 100%; border: 2px solid #f0d0d8; 
      border-radius: 12px; margin-bottom: 20px; text-align: center; letter-spacing: 4px;
    }
    .auth-btn {
      background: linear-gradient(135deg, #ff91b4, #ec407a); color: #fff;
      border: none; padding: 12px 32px; font-size: 18px; border-radius: 999px;
      cursor: pointer; width: 100%; font-weight: bold;
    }

    /* â–¼â–¼â–¼ ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–æ¸ˆã¿ï¼‰ â–¼â–¼â–¼ */
    :root {
      --bg: #fff0f5;             /* èƒŒæ™¯ï¼šã”ãè–„ã„ãƒ”ãƒ³ã‚¯ */
      --bg-card: #ffffff;        /* ã‚«ãƒ¼ãƒ‰ï¼šç™½ */
      --ink: #442c2e;            /* æ–‡å­—ï¼šæ¿ƒã„ãƒ–ãƒ©ã‚¦ãƒ³ */
      --ink-muted: #886064;      /* è–„ã„æ–‡å­—ï¼šã‚ãšãè‰²ã‚°ãƒ¬ãƒ¼ */
      --accent: #ff91b4;         /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼šæ˜ã‚‹ã„ãƒ”ãƒ³ã‚¯ */
      --accent-deep: #e91e63;    /* æ¿ƒã„ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼šã—ã£ã‹ã‚Šã—ãŸãƒ”ãƒ³ã‚¯ */
      --accent-soft: #ffe4ee;    /* è–„ã„ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼šæ·¡ã„ãƒ”ãƒ³ã‚¯ */
      --line: #f0d0d8;           /* ç·šï¼šãƒ”ãƒ³ã‚¯ãƒ™ãƒ¼ã‚¸ãƒ¥ */
      --danger: #ef5350;         /* å‰Šé™¤è‰²ï¼šãƒã‚¤ãƒ«ãƒ‰ãªèµ¤ */
      --radius-lg: 16px;         /* è§’ä¸¸ */
      --shadow-soft: 0 4px 16px rgba(233, 30, 99, 0.08);
      --font-main: "M PLUS Rounded 1c", sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; }
    body {
      font-family: var(--font-main);
      background: radial-gradient(circle at top left, #fff0f6, #fffbfd 60%, #ffffff);
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
      font-size: 16px; /* â˜…ä¿®æ­£: 40px -> 16px (ã‚¹ãƒãƒ›æ¨™æº–ã‚µã‚¤ã‚º) */
      line-height: 1.6;
    }

    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .hd { position: sticky; top: 0; z-index: 10; background: rgba(255, 240, 245, 0.95); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 2px 10px rgba(233, 30, 99, 0.05); }
    .hd-inner { max-width: 960px; margin: 0 auto; padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .hd-title-block { display: flex; flex-direction: column; gap: 2px; }
    .hd-title { margin: 0; font-size: 18px; font-weight: 700; color: var(--accent-deep); }
    .hd-subtitle { margin: 0; font-size: 12px; color: var(--ink-muted); }
    .hd-actions { display: flex; align-items: center; gap: 8px; }
    
    .main { max-width: 960px; margin: 0 auto; padding: 16px 12px 24px; }
    .ft { max-width: 960px; margin: 0 auto; padding: 16px 12px 32px; text-align: center; font-size: 12px; color: var(--ink-muted); }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card { background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-soft); padding: 16px; margin-bottom: 16px; border: 1px solid #fff; }
    .card-hd { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 12px; }
    .card-title-block { display: flex; flex-direction: column; gap: 2px; }
    .card-title { margin: 0; font-size: 18px; font-weight: 700; color: var(--ink); }
    .card-subtitle { margin: 0; font-size: 13px; color: var(--ink-muted); }
    .card-actions { display: flex; gap: 8px; }
    .card-bd { margin-bottom: 12px; }
    .card-ft { border-top: 2px dashed var(--line); padding-top: 12px; }

    /* ã‚°ãƒªãƒƒãƒ‰ */
    .grid { display: grid; gap: 12px; }
    .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

    /* ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; font-size: 14px; }
    .field > span { color: var(--ink-muted); font-weight: 500; }
    .field input, .field textarea { border-radius: 8px; border: 2px solid var(--line); padding: 10px; font-size: 16px; font-family: var(--font-main); outline: none; transition: all 0.2s ease; background-color: #ffffff; color: var(--ink); }
    .field textarea { resize: vertical; min-height: 80px; }
    .field input:focus, .field textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(255, 145, 180, 0.2); background-color: #fff9fb; }
    .field input:disabled { background-color: #f0f0f0; color: #999; border-color: #ddd; }

    /* ãƒœã‚¿ãƒ³ */
    .btn, .btn-outline, .btn-danger { border-radius: 999px; border: none; font-size: 14px; padding: 10px 20px; cursor: pointer; font-family: var(--font-main); font-weight: 700; display: inline-flex; align-items: center; justify-content: center; gap: 6px; white-space: nowrap; transition: transform 0.1s ease, box-shadow 0.2s ease; }
    .btn { background: linear-gradient(135deg, #ff91b4, #ec407a); color: #ffffff; box-shadow: 0 4px 10px rgba(236, 64, 122, 0.4); }
    .btn-outline { background: #ffffff; border: 2px solid var(--accent); color: var(--accent-deep); }
    .btn-danger { background: var(--danger); color: #ffffff; box-shadow: 0 4px 10px rgba(239, 83, 80, 0.3); }
    .btn:active, .btn-outline:active, .btn-danger:active { transform: scale(0.96); box-shadow: none; }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
    .calendar-wrapper { padding: 4px 0 0; }
    .calendar-grid { display: flex; flex-direction: column; gap: 4px; }
    .cal-row { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap: 4px; }
    .cal-row-head { margin-bottom: 4px; }
    .cal-cell { 
      min-height: 100px; /* â˜…ä¿®æ­£: 300px -> 100px */
      background: #ffffff; border-radius: 8px; border: 1px solid var(--line); padding: 4px; font-size: 12px; position: relative; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.02); 
    }
    .cal-cell-head { background: transparent; border: none; text-align: center; font-size: 12px; font-weight: 700; color: var(--ink-muted); min-height: auto; box-shadow: none; padding-bottom: 4px; }
    .cal-cell-empty { background: transparent; border: none; box-shadow: none; }
    .cal-day-label { font-size: 16px; font-weight: 700; padding-left: 2px; color: var(--ink); }
    .cal-cell-today { border: 2px solid var(--accent); background-color: #fff0f5; }
    .cal-cell-selected { box-shadow: 0 0 0 2px rgba(255, 145, 180, 0.6); transform: scale(0.98); transition: transform 0.1s; }
    .cal-cell-has-lesson { background: linear-gradient(to bottom, #fff9fb, #ffffff); }
    .cal-tags { margin-top: 4px; display: flex; flex-direction: column; gap: 2px; }

    /* ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚° */
    .cal-tag { border-radius: 4px; padding: 2px 4px; font-size: 10px; line-height: 1.2; color: #ffffff; background: var(--accent); display: block; width: 100%; box-sizing: border-box; max-width: 100%; white-space: normal; word-break: break-word; }
    .cal-tag.new-customer { border: 2px solid #FF8C00 !important; z-index: 2; position: relative; }

    /* æ—¥ãƒ‘ãƒãƒ« */
    .day-panel { margin-top: 12px; }
    .day-panel-hd { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 8px; }
    .day-label-caption { margin: 0; font-size: 12px; color: var(--ink-muted); }
    .day-label-main { margin: 0; font-size: 18px; font-weight: 700; color: var(--ink); }
    .day-panel-actions { display: flex; gap: 6px; }

    /* ãƒ¬ãƒƒã‚¹ãƒ³æ ã‚«ãƒ¼ãƒ‰ */
    .slot-list { display: flex; flex-direction: column; gap: 8px; }
    .slot-card { border-radius: 12px; border: 1px solid var(--line); background: #ffffff; padding: 12px; font-size: 14px; cursor: pointer; transition: all 0.15s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
    .slot-card:hover { background-color: #fffafc; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(233, 30, 99, 0.1); }
    .slot-card-hd { display: flex; justify-content: space-between; align-items: baseline; gap: 6px; }
    .slot-card-title { font-weight: 700; font-size: 15px; color: var(--ink); }
    .slot-card-time { font-size: 16px; color: var(--accent-deep); font-weight: 700; }
    .slot-card-bd { margin-top: 4px; }
    .slot-card-desc { margin: 0; font-size: 12px; color: var(--ink-muted); }
    .slot-card-price { margin: 4px 0 0; font-size: 13px; color: var(--ink); font-weight: 500; }

    /* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ */
    .package-list { display: flex; flex-direction: column; gap: 8px; }
    .package-card { border-radius: 12px; border: 1px solid var(--line); background: #ffffff; padding: 12px; font-size: 14px; cursor: pointer; transition: all 0.15s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
    .package-card:hover { background-color: #fffafc; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(233, 30, 99, 0.1); }
    .package-card--select { border: 2px dashed var(--accent); background-color: #fffbfd; }
    .package-card-hd { display: flex; justify-content: space-between; align-items: baseline; gap: 6px; }
    .package-card-title { font-weight: 700; font-size: 15px; color: var(--ink); }
    .package-card-price { font-size: 16px; color: var(--accent-deep); font-weight: 700; }
    .package-card-bd { margin-top: 4px; }
    .package-card-desc { margin: 0; font-size: 12px; color: var(--ink-muted); }

    .package-summary { margin: 0 0 8px; font-size: 16px; font-weight: 700; color: var(--ink); padding-bottom: 8px; border-bottom: 1px dashed var(--line); }
    .subtle-text { font-size: 13px; color: var(--ink-muted); margin: 0 0 12px; }
    .empty-text { font-size: 13px; color: var(--ink-muted); margin: 8px 0; text-align: center; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(68, 44, 46, 0.4); backdrop-filter: blur(4px); z-index: 20; padding: 10px; }
    .modal-card { background: #ffffff; border-radius: 24px; max-width: 420px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.2); padding: 20px; animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; flex-direction: column; max-height: 90vh; }
    @keyframes modalPop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ€ãƒ«å¯¾å¿œ */
    #packageModal .modal-card, 
    #slotModal .modal-card, 
    #helpModal .modal-card,
    #packageSelectModal .modal-card,
    #settingsModal .modal-card,
    #customerListModal .modal-card,
    #customerHistoryModal .modal-card { 
      height: 90vh; /* ã‚¹ãƒãƒ›ã§å…¨ç”»é¢ã«ãªã‚Šã™ããªã„ã‚ˆã†ã«èª¿æ•´ */
    }
    
    .modal-card--alert { max-width: 320px; height: auto !important; padding: 20px; border-radius: 16px; border: 4px solid var(--line); }
    
    .modal-hd { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid var(--bg); padding-bottom: 10px; flex-shrink: 0; }
    .modal-hd strong { font-size: 18px; font-weight: 700; color: var(--accent-deep); }
    .modal-bd { font-size: 14px; overflow-y: auto; line-height: 1.6; flex: 1; }
    .modal-ft { margin-top: 16px; padding-top: 10px; flex-shrink: 0; }
    .modal-close { border: none; background: transparent; font-size: 28px; line-height: 1; cursor: pointer; padding: 0 8px; color: var(--ink-muted); }

    /* ãƒ˜ãƒ«ãƒ— */
    .help-content { font-size: 14px; line-height: 1.8; color: var(--ink); text-align: left; }
    .help-heading { font-size: 16px; font-weight: 700; color: var(--accent-deep); margin: 0 0 16px; padding-bottom: 8px; border-bottom: 2px solid var(--line); }
    .help-item { margin-bottom: 24px; }
    .help-item h4 { font-size: 15px; font-weight: 700; color: var(--ink); margin: 0 0 8px; display: flex; align-items: center; gap: 8px; }
    .help-item h4::before { content: ''; display: inline-block; width: 6px; height: 18px; background: var(--accent); border-radius: 4px; }
    .help-item p { margin: 0; }

    /* äºˆç´„è€…ãƒªã‚¹ãƒˆ */
    .guest-list { list-style: none; padding: 0; margin: 0; }
    .guest-item { padding: 10px 0; border-bottom: 1px solid var(--line); font-size: 14px; color: var(--ink); }
    .guest-item:last-child { border-bottom: none; }
    .loading-text { color: var(--ink-muted); font-size: 14px; text-align: center; }
    .error-text { color: var(--danger); font-size: 14px; text-align: center; }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° & ãƒˆãƒ¼ã‚¹ãƒˆ */
    .loading-overlay { position: fixed; inset: 0; background: rgba(255, 240, 245, 0.7); display: none; align-items: center; justify-content: center; z-index: 30; backdrop-filter: blur(5px); }
    .loading-spinner { width: 40px; height: 40px; border-radius: 50%; border: 4px solid #f8bbd0; border-top-color: #ec407a; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .toast { position: fixed; left: 50%; bottom: 30px; transform: translateX(-50%) translateY(40px); background: rgba(68, 44, 46, 0.9); color: #ffffff; padding: 10px 24px; font-size: 14px; border-radius: 999px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 40; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .toast.is-show { opacity: 1; transform: translateX(-50%) translateY(0); }

    @media (max-width: 600px) {
      .hd-inner, .main, .ft { padding-left: 12px; padding-right: 12px; }
      .card { padding: 12px; }
    }
  </style>
</head>
<body>

  <div id="authOverlay">
    <div class="auth-box">
      <div class="auth-title">ğŸ”’ ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</div>
      <p style="margin-bottom:10px; font-size:14px; color:#888;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      <input type="password" id="passInput" class="auth-input" inputmode="numeric" placeholder="â—â—â—â—">
      <button class="auth-btn" onclick="checkPassword()">èªè¨¼ã™ã‚‹</button>
      <p id="passError" style="color:#ef5350; margin-top:10px; font-weight:bold; display:none; font-size:14px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
    </div>
  </div>

  <div id="loadingOverlay" class="loading-overlay" style="display:none;">
    <div class="loading-spinner"></div>
  </div>

  <div id="customAlertModal" class="modal" style="display:none; z-index:9999;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--alert">
      <div class="modal-bd" style="text-align:center; padding: 20px 10px;">
        <p id="customAlertMessage" style="font-size:16px; font-weight:bold; color:var(--ink); margin:0 0 20px; white-space: pre-wrap;"></p>
        <button class="btn" type="button" onclick="closeCustomAlert()" style="min-width: 120px;">OK</button>
      </div>
    </div>
  </div>

  <div id="helpModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--lg">
      <div class="modal-hd">
        <strong class="help-title">æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«</strong>
        <button class="modal-close" type="button" onclick="adminCloseHelp()" aria-label="ãƒ˜ãƒ«ãƒ—ã‚’é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd help-content">
        <section class="help-section">
          <h3 class="help-heading">ğŸ“Œ ã¯ã˜ã‚ã«ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½œæˆï¼‰</h3>
          <div class="help-item">
            <p>ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ç™»éŒ²ã™ã‚‹å‰ã«ã€ã¾ãš<strong>ã€Œãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€</strong>ã‚’ä½œæˆã—ã¾ã™ã€‚<br>
            ã“ã‚Œã¯ãƒ¬ãƒƒã‚¹ãƒ³ã®é››å½¢ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã§ã™ã€‚<br><br>
            1. ç”»é¢ä¸‹ã®<strong>ã€Œãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€</strong>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ç§»å‹•ã—ã¾ã™ã€‚<br>
            2. <strong>ã€Œæ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç™»éŒ²ã€</strong>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚<br>
            3. ãƒ¬ãƒƒã‚¹ãƒ³åã€å…ˆç”Ÿåã€æ–™é‡‘ã€å®šå“¡ãªã©ã‚’å…¥åŠ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚<br>
            â€»ã‚ˆãä½¿ã†ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¤‡æ•°ç™»éŒ²ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚</p>
          </div>
        </section>
        <section class="help-section">
          <h3 class="help-heading">ğŸ—“ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç™»éŒ²æ–¹æ³•</h3>
          <div class="help-item">
            <h4>1. æ—¥ä»˜ã‚’é¸ã¶</h4>
            <p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã®<strong>ã€Œãƒ¬ãƒƒã‚¹ãƒ³ã‚’å…¥ã‚ŒãŸã„æ—¥ä»˜ã€</strong>ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™ã€‚</p>
          </div>
          <div class="help-item">
            <h4>2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é¸ã¶</h4>
            <p>ç™»éŒ²æ¸ˆã¿ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€è¿½åŠ ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã³ã¾ã™ã€‚</p>
          </div>
          <div class="help-item">
            <h4>3. æ™‚é–“ã‚’æ±ºã‚ã¦ä¿å­˜</h4>
            <p>é–‹å§‹æ™‚åˆ»ã¨çµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã€<strong>ã€Œä¿å­˜ã™ã‚‹ã€</strong>ã‚’æŠ¼ã™ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«åæ˜ ã•ã‚Œã¾ã™ã€‚<br>
            â€»ã“ã®ç”»é¢ã§ã€ãã®æ—¥ã ã‘ã®ç‰¹åˆ¥æ–™é‡‘ã‚„å®šå“¡ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p>
          </div>
        </section>
        <section class="help-section">
          <h3 class="help-heading">ğŸ“‹ äºˆç´„ç¢ºèªãƒ»å¤‰æ›´ãƒ»å‰Šé™¤</h3>
          <div class="help-item">
            <h4>äºˆç´„ã®ç¢ºèª</h4>
            <p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†…ã®ãƒ¬ãƒƒã‚¹ãƒ³æ ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ç·¨é›†ç”»é¢ãŒé–‹ãã¾ã™ã€‚<br>
            ç”»é¢ä¸‹éƒ¨ã«<strong>ã€Œäºˆç´„æ¸ˆã¿ã®ãŠå®¢æ§˜ã€</strong>ã®ãŠåå‰ã¨é›»è©±ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
          </div>
          <div class="help-item">
            <h4>ç·¨é›†ãƒ»å‰Šé™¤ã®ãƒ«ãƒ¼ãƒ«</h4>
            <p><strong>äºˆç´„ãŒ1åã§ã‚‚å…¥ã£ã¦ã„ã‚‹å ´åˆï¼š</strong><br>
            ãƒˆãƒ©ãƒ–ãƒ«é˜²æ­¢ã®ãŸã‚ã€<strong>ã€Œæ–™é‡‘ã®å¤‰æ›´ã€</strong>ã¯ã§ãã¾ã›ã‚“ã€‚<br>
            ã¾ãŸã€ç¾åœ¨ã®äºˆç´„æ•°ã‚ˆã‚Šå°‘ãªããªã‚‹ã‚ˆã†ãª<strong>ã€Œå®šå“¡ã®å¤‰æ›´ã€</strong>ã‚‚ã§ãã¾ã›ã‚“ã€‚<br><br>
            â€»äºˆç´„ãŒå…¥ã£ã¦ã„ãªã„ãƒ¬ãƒƒã‚¹ãƒ³ã¯è‡ªç”±ã«å‰Šé™¤ãƒ»å¤‰æ›´ãŒå¯èƒ½ã§ã™ã€‚</p>
          </div>
        </section>
        <section class="help-section">
          <h3 class="help-heading">ğŸ  ã‚¹ã‚¿ã‚¸ã‚ªæƒ…å ±ã®å¤‰æ›´</h3>
          <div class="help-item">
            <p>ç”»é¢ä¸€ç•ªä¸‹ã®<strong>ã€Œã‚¹ã‚¿ã‚¸ã‚ªæƒ…å ±ãƒ»è¨­å®šã€</strong>ã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ä»¥ä¸‹ã®æƒ…å ±ã‚’ã„ã¤ã§ã‚‚å¤‰æ›´ã§ãã¾ã™ã€‚<br>
            ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªå<br>
            ãƒ»ç´¹ä»‹æ–‡ (Concept)<br>
            ãƒ»ä½æ‰€ (Googleãƒãƒƒãƒ—ãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™)<br>
            ãƒ»ãŠå•ã„åˆã‚ã›ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<br>
            ãƒ»è¨­å‚™æƒ…å ±</p>
          </div>
        </section>
      </div>
      <div class="modal-ft">
        <button class="btn" type="button" onclick="adminCloseHelp()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--lg">
      <div class="modal-hd">
        <strong class="help-title">ã‚¹ã‚¿ã‚¸ã‚ªæƒ…å ±ã®ç·¨é›†</strong>
        <button class="modal-close" type="button" onclick="adminCloseSettings()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <p class="subtle-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã®ã€ŒAbout Studioã€ã«è¡¨ç¤ºã•ã‚Œã‚‹å†…å®¹ã‚’ç·¨é›†ã—ã¾ã™ã€‚</p>
        <label class="field">
          <span>ã‚¹ã‚¿ã‚¸ã‚ªå</span>
          <input id="setStudioName" type="text" placeholder="Studio Torajiro" />
        </label>
        <label class="field">
          <span>Concept (ç´¹ä»‹æ–‡)</span>
          <textarea id="setConcept" rows="6" placeholder="ã‚¹ã‚¿ã‚¸ã‚ªã®é­…åŠ›ã‚„ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        </label>
        <label class="field">
          <span>ä½æ‰€ (Googleãƒãƒƒãƒ—ãŒè‡ªå‹•é€£å‹•ã—ã¾ã™)</span>
          <input id="setAddress" type="text" placeholder="æ±äº¬éƒ½åƒä»£ç”°åŒº..." />
        </label>
        <label class="field">
          <span>ãŠå•ã„åˆã‚ã›å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
          <input id="setContactEmail" type="email" placeholder="info@example.com" />
          <span style="font-size:12px; color:#888;">â€» ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã€ãŠå®¢æ§˜ãŒã“ã“ã¸ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</span>
        </label>
        <label class="field">
          <span>è¨­å‚™ãƒ»ã‚µãƒ¼ãƒ“ã‚¹</span>
          <input id="setFacilities" type="text" placeholder="æ›´è¡£å®¤ã‚ã‚Š / ãƒãƒƒãƒˆç„¡æ–™" />
        </label>
      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn-outline" type="button" onclick="adminCloseSettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="btnSaveSettings" class="btn" type="button" onclick="adminSaveSettings()">ä¿å­˜ã—ã¦åæ˜ </button>
      </div>
    </div>
  </div>

  <div id="customerListModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--lg">
      <div class="modal-hd">
        <strong>é¡§å®¢å°å¸³ãƒªã‚¹ãƒˆ</strong>
        <button class="modal-close" type="button" onclick="adminCloseCustomerList()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <div style="margin-bottom:16px;">
          <input id="customerSearchInput" type="text" placeholder="åå‰ã‚„é›»è©±ç•ªå·ã§æ¤œç´¢..." 
                 style="width:100%; padding:12px; font-size:16px; border:2px solid var(--line); border-radius:12px; outline:none;">
        </div>
        <p id="customerListMsg" class="subtle-text" style="text-align:center; display:none;">ãƒ‡ãƒ¼ã‚¿ãªã—</p>
        <ul id="customerListUL" class="guest-list"></ul>
      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn" type="button" onclick="adminCloseCustomerList()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="customerHistoryModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--lg">
      <div class="modal-hd">
        <strong>æ¥åº—ãƒ»äºˆç´„å±¥æ­´</strong>
        <button class="modal-close" type="button" onclick="adminCloseCustomerHistory()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <p id="historyCustomerName" class="subtle-text" style="border-bottom:2px dashed var(--line); padding-bottom:8px; margin-bottom:16px;">- æ§˜ ã®å±¥æ­´</p>
        <ul id="customerHistoryUL" class="guest-list"></ul>
      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn" type="button" onclick="adminCloseCustomerHistory()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="packageModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-hd">
        <strong id="packageModalTitle">ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç™»éŒ²</strong>
        <button class="modal-close" type="button" onclick="adminClosePackageModal()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <input type="hidden" id="packageId" />
        <label class="field">
          <span>ãƒ¬ãƒƒã‚¹ãƒ³å</span>
          <input id="packageLessonName" type="text" autocomplete="off" />
        </label>
        <label class="field">
          <span>å…ˆç”Ÿå</span>
          <input id="packageTeacherName" type="text" autocomplete="off" />
        </label>
        <label class="field">
          <span>ãƒ¬ãƒƒã‚¹ãƒ³å†…å®¹</span>
          <textarea id="packageDescription" rows="4"></textarea>
        </label>
        <div class="grid grid-2">
          <label class="field">
            <span>æ–™é‡‘ï¼ˆå††ï¼‰</span>
            <input id="packagePrice" type="number" min="0" inputmode="numeric" />
          </label>
          <label class="field">
            <span>å®šå“¡ï¼ˆäººï¼‰</span>
            <input id="packageCapacity" type="number" min="0" inputmode="numeric" />
          </label>
        </div>
        <label class="field">
          <span>æ¨™æº–è‰²</span>
          <input id="packageColor" type="hidden" />
          <div id="packageColorPalette" class="color-palette"></div>
        </label>
      </div>
      <div class="modal-ft" style="display:flex;justify-content:space-between;gap:8px;">
        <button id="packageDeleteBtn" class="btn-outline" type="button" style="display:none;">ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤</button>
        <div style="flex:1;text-align:right;">
          <button class="btn-outline" type="button" onclick="adminClosePackageModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button id="packageSaveBtn" class="btn" type="button">ä¿å­˜ã™ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <div id="packageDeleteModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-hd">
        <strong>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤</strong>
      </div>
      <div class="modal-bd">
        <p>ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ<br />æ—¢ã«ä½œæˆã—ãŸãƒ¬ãƒƒã‚¹ãƒ³æ ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚</p>
      </div>
      <div class="modal-ft" style="display:flex;justify-content:flex-end;gap:8px;">
        <button class="btn-outline" type="button" onclick="adminClosePackageDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="packageDeleteConfirmBtn" class="btn-danger" type="button">å‰Šé™¤ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="packageSelectModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card modal-card--lg">
      <div class="modal-hd">
        <strong>ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é¸æŠ</strong>
        <button class="modal-close" type="button" onclick="adminClosePackageSelectModal()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <p id="packageSelectDateLabel" class="subtle-text"></p>
        <div id="packageSelectList" class="package-list"></div>
        <p class="hint">â€» ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä¸‹éƒ¨ã®ã€Œãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‹ã‚‰è¿½åŠ ãƒ»ç·¨é›†ã§ãã¾ã™ã€‚</p>
      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn-outline" type="button" onclick="adminClosePackageSelectModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="slotModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-hd">
        <strong id="slotModalTitle">ãƒ¬ãƒƒã‚¹ãƒ³æ ã®ç™»éŒ²</strong>
        <button class="modal-close" type="button" onclick="adminCloseSlotModal()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <input type="hidden" id="slotId" />
        <p id="slotPackageSummary" class="package-summary"></p>
        <p id="slotDateLabel" class="subtle-text"></p>

        <div class="grid grid-2">
          <label class="field">
            <span>é–‹å§‹æ™‚åˆ»</span>
            <input id="slotStartTime" type="time" />
          </label>
          <label class="field">
            <span>çµ‚äº†æ™‚åˆ»</span>
            <input id="slotEndTime" type="time" />
          </label>
        </div>

        <div class="grid grid-2">
          <label class="field">
            <span>æ–™é‡‘ï¼ˆå††ï¼‰</span>
            <input id="slotPrice" type="number" min="0" inputmode="numeric" />
            <span id="priceLockMsg" style="font-size:12px; color:var(--danger); display:none;">â€»äºˆç´„æ¸ˆã¿ã®ãŸã‚å¤‰æ›´ä¸å¯</span>
          </label>
          <label class="field">
            <span>å®šå“¡ï¼ˆäººï¼‰</span>
            <input id="slotCapacity" type="number" min="0" inputmode="numeric" />
          </label>
        </div>

        <label class="field">
          <span>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è‰²</span>
          <input id="slotColor" type="hidden" />
          <div id="slotColorPalette" class="color-palette"></div>
        </label>

        <div id="slotGuestSection" style="display:none; margin-top:24px; border-top:2px dashed var(--line); padding-top:16px;">
          <p style="font-size:16px; font-weight:bold; color:var(--ink); margin-bottom:8px;">äºˆç´„æ¸ˆã¿ã®ãŠå®¢æ§˜</p>
          <p style="font-size:12px; color:var(--ink-muted); margin-bottom:8px;">ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™</p>
          <ul id="slotGuestList" class="guest-list"></ul>
        </div>

      </div>
      <div class="modal-ft" style="display:flex;justify-content:space-between;gap:8px;">
        <button id="slotDeleteBtn" class="btn-outline" type="button" style="display:none;">å‰Šé™¤</button>
        <div style="flex:1;text-align:right;">
          <button class="btn-outline" type="button" onclick="adminCloseSlotModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button id="slotSaveBtn" class="btn" type="button">ä¿å­˜ã™ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <div id="guestDetailModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-hd">
        <strong>ãŠå®¢æ§˜è©³ç´°</strong>
        <button class="modal-close" type="button" onclick="adminCloseGuestDetailModal()" aria-label="é–‰ã˜ã‚‹">Ã—</button>
      </div>
      <div class="modal-bd">
        <label class="field">
          <span>ãŠåå‰</span>
          <input id="guestName" type="text" readonly disabled />
        </label>
        <label class="field">
          <span>é›»è©±ç•ªå·</span>
          <a id="guestPhoneLink" href="#" style="display:none;"></a>
          <input id="guestPhone" type="text" readonly disabled />
        </label>
        <label class="field">
          <span>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
          <input id="guestEmail" type="text" readonly disabled />
        </label>
        
        <div class="grid grid-2">
           <label class="field">
             <span>æ¥åº—å›æ•°</span>
             <input id="guestVisitCount" type="text" readonly disabled />
           </label>
           <label class="field">
             <span>é¡§å®¢ID</span>
             <input id="guestCustomerId" type="text" readonly disabled />
           </label>
        </div>

        <label class="field">
          <span>å‚™è€ƒ (ãƒ¡ãƒ¢)</span>
          <textarea id="guestMemo" rows="3" readonly disabled></textarea>
        </label>

        <div style="margin-top:16px; text-align:center;">
           <button id="btnGuestHistoryFromDetail" class="btn-outline" type="button" style="width:100%;">éå»ã®å±¥æ­´ã‚’è¦‹ã‚‹</button>
        </div>

      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn" type="button" onclick="adminCloseGuestDetailModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="slotDeleteModal" class="modal" style="display:none;" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-hd">
        <strong>ãƒ¬ãƒƒã‚¹ãƒ³æ ã®å‰Šé™¤</strong>
      </div>
      <div class="modal-bd">
        <p>ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³æ ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
      </div>
      <div class="modal-ft" style="text-align:right;">
        <button class="btn-outline" type="button" onclick="adminCloseSlotDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="slotDeleteConfirmBtn" class="btn-danger" type="button">å‰Šé™¤ã™ã‚‹</button>
      </div>
    </div>
  </div>

  <header class="hd">
    <div class="hd-inner">
      <div class="hd-title-block">
        <h1 class="hd-title">ã‚¹ã‚¿ã‚¸ã‚ªå¯…æ¬¡éƒ äºˆç´„ç®¡ç†</h1>
        <p class="hd-subtitle">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ç™»éŒ²ãƒ»ç·¨é›†ã§ãã¾ã™</p>
      </div>
      <div class="hd-actions">
        <button id="btnHelp" class="btn-outline" type="button">ä½¿ã„æ–¹</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section class="card">
      <div class="card-hd">
        <div class="card-title-block">
          <p class="card-subtitle">æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™</p>
        </div>
        <div class="card-actions">
          <button id="monthPrev" class="btn-outline" type="button">â—€</button>
          <span id="monthLabel" class="month-label"></span>
          <button id="monthNext" class="btn-outline" type="button">â–¶</button>
        </div>
      </div>
      <div class="card-bd calendar-wrapper">
        <div class="calendar-grid" id="calendarGrid" aria-label="ãƒ¬ãƒƒã‚¹ãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"></div>
      </div>
      <div class="card-ft day-panel">
        <div class="day-panel-hd">
          <div>
            <p class="day-label-caption">é¸æŠä¸­ã®æ—¥ä»˜</p>
            <p id="selectedDateLabel" class="day-label-main">-</p>
          </div>
          <div class="day-panel-actions">
            <button id="btnAddSlot" class="btn" type="button">ã“ã®æ—¥ã«ãƒ¬ãƒƒã‚¹ãƒ³ã‚’è¿½åŠ </button>
          </div>
        </div>
        <div id="slotList" class="slot-list"></div>
      </div>
    </section>

    <section class="card">
      <div class="card-hd">
        <div class="card-title-block">
          <h2 class="card-title">ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</h2>
          <p class="card-subtitle">ãƒ¬ãƒƒã‚¹ãƒ³åãƒ»å…ˆç”Ÿãƒ»å†…å®¹ãƒ»æ–™é‡‘ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã—ã¾ã™</p>
        </div>
        <div class="card-actions">
          <button id="btnNewPackage" class="btn" type="button">æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç™»éŒ²</button>
        </div>
      </div>
      <div class="card-bd">
        <div id="packageList" class="package-list"></div>
      </div>
    </section>

    <section class="card">
      <div class="card-hd">
        <div class="card-title-block">
          <h2 class="card-title">é¡§å®¢å°å¸³</h2>
          <p class="card-subtitle">ãŠå®¢æ§˜ã®æƒ…å ±ã‚„éå»ã®å±¥æ­´ã‚’ç¢ºèªã—ã¾ã™</p>
        </div>
        <div class="card-actions">
          <button class="btn" type="button" onclick="adminOpenCustomerList()">é¡§å®¢ãƒªã‚¹ãƒˆã‚’é–‹ã</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-hd">
        <div class="card-title-block">
          <h2 class="card-title">ã‚¹ã‚¿ã‚¸ã‚ªæƒ…å ±ãƒ»è¨­å®š</h2>
          <p class="card-subtitle">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ä½æ‰€ã‚„ç´¹ä»‹æ–‡ã‚’ç·¨é›†ã—ã¾ã™</p>
        </div>
        <div class="card-actions">
          <button class="btn" type="button" onclick="adminOpenSettings()">æƒ…å ±ã‚’ç·¨é›†ã™ã‚‹</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="ft">
    <small>Â© ã‚¹ã‚¿ã‚¸ã‚ªå¯…æ¬¡éƒäºˆç´„ã‚·ã‚¹ãƒ†ãƒ </small>
  </footer>

  <script>
    function openCustomAlert(msg) {
      var modal = document.getElementById('customAlertModal');
      var msgEl = document.getElementById('customAlertMessage');
      if (modal && msgEl) {
        msgEl.textContent = msg;
        modal.style.display = 'flex';
      }
    }
    function closeCustomAlert() {
      var modal = document.getElementById('customAlertModal');
      if (modal) modal.style.display = 'none';
    }
    window.alert = function(message) { openCustomAlert(message); };

    // é¡§å®¢ãƒªã‚¹ãƒˆãƒ»å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰é–¢æ•°
    function adminOpenCustomerList(){
      var m = document.getElementById('customerListModal');
      if(m) m.style.display = 'flex';
      if(typeof renderCustomerList === 'function') renderCustomerList();
    }
    function adminCloseCustomerList(){
      var m = document.getElementById('customerListModal');
      if(m) m.style.display = 'none';
    }
    function adminCloseCustomerHistory(){
      var m = document.getElementById('customerHistoryModal');
      if(m) m.style.display = 'none';
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼æ©Ÿèƒ½
    function checkPassword() {
      const input = document.getElementById('passInput');
      const err = document.getElementById('passError');
      if (input.value === ADMIN_PASSWORD) {
        document.getElementById('authOverlay').style.opacity = '0';
        setTimeout(() => { document.getElementById('authOverlay').style.display = 'none'; }, 300);
        // åˆå›ãƒ­ãƒ¼ãƒ‰
        gas('apiGetAdminInit').then(function(data){ applyAdminInit(data); }).catch(function(err){ console.error(err); });
      } else {
        err.style.display = 'block';
        input.value = '';
      }
    }
    document.getElementById('passInput').addEventListener('keypress', function(e){
      if(e.key === 'Enter') checkPassword();
    });

    // APIé€šä¿¡é–¢æ•°
    function gas(actionName, payload) {
      if(!GAS_API_URL || GAS_API_URL.indexOf('script.google.com') === -1) {
        alert('GAS_API_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚index.htmlã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        return Promise.reject('No API URL');
      }

      setLoading(true);
      return new Promise(function(resolve, reject){
        fetch(GAS_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify({ action: actionName, payload: payload })
        })
        .then(function(response){ return response.json(); })
        .then(function(result){
          setLoading(false);
          if (result.error) {
            throw new Error(result.error);
          }
          resolve(result);
        })
        .catch(function(err){
          setLoading(false);
          console.error("API Error:", err);
          alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + err.message);
          reject(err);
        });
      });
    }

    function setLoading(flag){
      var ov = document.getElementById('loadingOverlay');
      if(!ov) return;
      ov.style.display = flag ? 'flex' : 'none';
    }

    var toastTimer = null;
    function showToast(message){
      var el = document.getElementById('toast');
      if(!el){
        el = document.createElement('div');
        el.id = 'toast';
        el.className = 'toast';
        document.body.appendChild(el);
      }
      el.textContent = message || '';
      el.classList.add('is-show');
      if(toastTimer){ clearTimeout(toastTimer); }
      toastTimer = setTimeout(function(){ el.classList.remove('is-show'); }, 2500);
    }
  </script>

  <script>
  var adminState = {
    today: null,
    currentYear: null,
    currentMonth: null,
    selectedDate: null,
    lessons: [],
    packages: [],
    settings: {}, 
    dom: {},
    customerList: []
  };

  document.addEventListener('DOMContentLoaded', function(){
    adminState.dom.monthLabel        = document.getElementById('monthLabel');
    adminState.dom.calendarGrid      = document.getElementById('calendarGrid');
    adminState.dom.selectedDateLabel = document.getElementById('selectedDateLabel');
    adminState.dom.slotList          = document.getElementById('slotList');
    adminState.dom.packageList       = document.getElementById('packageList');

    var btnPrev = document.getElementById('monthPrev');
    if(btnPrev) btnPrev.addEventListener('click', function(){ changeMonth(-1); });
    var btnNext = document.getElementById('monthNext');
    if(btnNext) btnNext.addEventListener('click', function(){ changeMonth(1); });

    var btnHelp = document.getElementById('btnHelp');
    if(btnHelp) btnHelp.addEventListener('click', adminOpenHelp);

    var btnAddSlot = document.getElementById('btnAddSlot');
    if(btnAddSlot){
      btnAddSlot.addEventListener('click', function(){
        if(!adminState.selectedDate){ alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); return; }
        if(typeof adminOpenPackageSelect === 'function'){
          adminOpenPackageSelect(adminState.selectedDate);
        }
      });
    }

    var btnNewPackage = document.getElementById('btnNewPackage');
    if(btnNewPackage) btnNewPackage.addEventListener('click', adminOpenPackageModalNew);

    var searchInput = document.getElementById('customerSearchInput');
    if(searchInput){
      searchInput.addEventListener('input', function(){
        filterCustomerList(this.value);
      });
    }
  });

  function applyAdminInit(data){
    if(!data) return;
    adminState.today = data.today || null;
    adminState.lessons = Array.isArray(data.lessons) ? data.lessons : [];
    adminState.packages = Array.isArray(data.packages) ? data.packages : [];
    adminState.settings = data.settings || {}; 

    var y = null;
    var m = null;
    if(adminState.today){
      var parts = adminState.today.split('-');
      if(parts.length >= 2){
        y = parseInt(parts[0], 10);
        m = parseInt(parts[1], 10);
      }
    }
    if(!y || !m){
      var now = new Date();
      y = now.getFullYear();
      m = now.getMonth() + 1;
    }
    adminState.currentYear = y;
    adminState.currentMonth = m;
    adminState.selectedDate = adminState.today;

    renderMonth();
    updateSelectedDateLabel();
    renderSlotListForSelectedDate();
    renderPackageList();
  }

  function changeMonth(diff){
    if(typeof diff !== 'number') diff = 0;
    var y = adminState.currentYear;
    var m = adminState.currentMonth;
    if(!y || !m) return;
    m += diff;
    if(m <= 0){ m += 12; y -= 1; }
    else if(m >= 13){ m -= 12; y += 1; }
    adminState.currentYear = y;
    adminState.currentMonth = m;
    renderMonth();
  }

  function isLightColor(hex) {
    if (!hex) return false;
    if (hex.startsWith('#')) hex = hex.slice(1);
    if (hex.length === 3) hex = hex.split('').map(function(c){ return c+c; }).join('');
    
    var r = parseInt(hex.substr(0, 2), 16);
    var g = parseInt(hex.substr(2, 2), 16);
    var b = parseInt(hex.substr(4, 2), 16);
    var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
    return yiq >= 200;
  }

  function renderMonth(){
    var grid = adminState.dom.calendarGrid;
    if(!grid) return;
    grid.innerHTML = '';
    var year = adminState.currentYear;
    var month = adminState.currentMonth;
    if(!year || !month) return;

    var weekdays = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
    var headerRow = document.createElement('div');
    headerRow.className = 'cal-row cal-row-head';
    weekdays.forEach(function(w){
      var cell = document.createElement('div');
      cell.className = 'cal-cell cal-cell-head';
      cell.textContent = w;
      headerRow.appendChild(cell);
    });
    grid.appendChild(headerRow);

    var firstDate = new Date(year, month - 1, 1);
    var firstDow = firstDate.getDay();
    var lastDate = new Date(year, month, 0).getDate();

    if(adminState.dom.monthLabel) adminState.dom.monthLabel.textContent = year + 'å¹´' + month + 'æœˆ';
    var lessonMap = {};
    adminState.lessons.forEach(function(lesson){
      var d = lesson.date;
      if(!d) return;
      if(!lessonMap[d]) lessonMap[d] = [];
      lessonMap[d].push(lesson);
    });

    var dayNum = 1;
    for(var row = 0; row < 6; row++){
      var rowEl = document.createElement('div');
      rowEl.className = 'cal-row';
      var rowHasDate = false;

      for(var col = 0; col < 7; col++){
        var cell = document.createElement('div');
        cell.className = 'cal-cell';

        var cellIndex = row * 7 + col;
        var dateStr = '';
        if(cellIndex >= firstDow && dayNum <= lastDate){
          var rowHasDate = true;
          var d = dayNum;
          var dStr = year + '-' + ('0' + month).slice(-2) + '-' + ('0' + d).slice(-2);
          dateStr = dStr;

          var dayLabel = document.createElement('div');
          dayLabel.className = 'cal-day-label';
          dayLabel.textContent = d;
          cell.appendChild(dayLabel);

          if(adminState.today === dStr) cell.classList.add('cal-cell-today');
          if(adminState.selectedDate === dStr) cell.classList.add('cal-cell-selected');

          var lessons = lessonMap[dStr] || [];
          if(lessons.length > 0){
            cell.classList.add('cal-cell-has-lesson');
            var tagsWrap = document.createElement('div');
            tagsWrap.className = 'cal-tags';
            lessons.sort(function(a, b){
              var at = (a.startTime || '');
              var bt = (b.startTime || '');
              if(at < bt) return -1;
              if(at > bt) return 1;
              return 0;
            });
            lessons.forEach(function(ls){
              var tag = document.createElement('div');
              tag.className = 'cal-tag';
              
              var prefix = '';
              if(ls.hasNewCustomer){
                tag.classList.add('new-customer'); 
                prefix = 'ğŸ”° '; 
              }

              if(ls.color) {
                tag.style.backgroundColor = ls.color;
                if(isLightColor(ls.color)){
                  tag.style.color = '#333333';
                  tag.style.border = '1px solid #cccccc';
                } else {
                  tag.style.color = '#ffffff';
                }
              }
              
              var teacher = (ls.teacherName || '');
              var lessonShort = String(ls.lessonName || '');

              var capNum = parseInt(ls.capacity, 10);
              var capLabel = '';
              if(!isNaN(capNum) && capNum > 0){
                var reserved = (typeof ls.reservedCount === 'number') ? ls.reservedCount : 0;
                capLabel = reserved + '/' + capNum;
              }

              var parts = [];
              if(lessonShort) parts.push(lessonShort);
              if(teacher) parts.push(teacher);
              if(capLabel) parts.push(capLabel);
              
              tag.textContent = prefix + parts.join(' / ');
              tagsWrap.appendChild(tag);
            });
            cell.appendChild(tagsWrap);
          }

          (function(dateStrFixed){
            cell.addEventListener('click', function(){
              var prevSelected = adminState.selectedDate;
              adminState.selectedDate = dateStrFixed;
              updateSelectedDateLabel();
              renderMonth();
              renderSlotListForSelectedDate();

              if(prevSelected === dateStrFixed && 
                typeof adminOpenPackageSelect === 'function'){
                adminOpenPackageSelect(dateStrFixed);
              }
            });
          })(dStr);
          dayNum++;
        }else{
          cell.classList.add('cal-cell-empty');
        }
        rowEl.appendChild(cell);
      }
      if(rowHasDate) grid.appendChild(rowEl);
    }
  }

  function updateSelectedDateLabel(){
    var el = adminState.dom.selectedDateLabel;
    if(!el) return;
    if(!adminState.selectedDate){ el.textContent = '-'; return; }
    el.textContent = formatDateLabel(adminState.selectedDate);
  }

  function formatDateLabel(dateStr){
    if(!dateStr) return '';
    var parts = dateStr.split('-');
    if(parts.length < 3) return dateStr;
    var y = parseInt(parts[0], 10);
    var m = parseInt(parts[1], 10);
    var d = parseInt(parts[2], 10);
    if(isNaN(y) || isNaN(m) || isNaN(d)) return dateStr;
    var dt = new Date(y, m - 1, d);
    var wd = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][dt.getDay()] || '';
    return y + 'å¹´' + m + 'æœˆ' + d + 'æ—¥(' + wd + ')';
  }

  function renderSlotListForSelectedDate(){
    var listEl = adminState.dom.slotList;
    if(!listEl) return;
    listEl.innerHTML = '';
    var dateStr = adminState.selectedDate;
    if(!dateStr){
      var p = document.createElement('p');
      p.className = 'empty-text';
      p.textContent = 'æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
      listEl.appendChild(p);
      return;
    }

    var lessons = adminState.lessons.filter(function(ls){
      return ls.date === dateStr && ls.status !== 'å‰Šé™¤';
    });
    if(lessons.length === 0){
      var p2 = document.createElement('p');
      p2.className = 'empty-text';
      p2.textContent = 'ã“ã®æ—¥ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
      listEl.appendChild(p2);
      return;
    }

    lessons.sort(function(a, b){
      var at = (a.startTime || '');
      var bt = (b.startTime || '');
      if(at < bt) return -1;
      if(at > bt) return 1;
      return 0;
    });
    lessons.forEach(function(ls){
      var card = document.createElement('div');
      card.className = 'slot-card';

      var header = document.createElement('div');
      header.className = 'slot-card-hd';
      var title = document.createElement('div');
      title.className = 'slot-card-title';
      var tName = (ls.teacherName || '');
      var lName = (ls.lessonName || 'ãƒ¬ãƒƒã‚¹ãƒ³');
      
      var capNum = parseInt(ls.capacity, 10);
      var capLabel = '';
      if(!isNaN(capNum) && capNum > 0){
        var reserved = (typeof ls.reservedCount === 'number') ? ls.reservedCount : 0;
        capLabel = ' (' + reserved + '/' + capNum + ')';
      }

      var prefix = '';
      if(ls.hasNewCustomer){
        prefix = 'ğŸ”° ';
      }

      if(tName) title.textContent = prefix + tName + ' ï¼ ' + lName + capLabel;
      else title.textContent = prefix + lName + capLabel;
      
      header.appendChild(title);

      var time = document.createElement('div');
      time.className = 'slot-card-time';
      var label = (ls.startTime || '') + (ls.endTime ? 'ã€œ' + ls.endTime : '');
      time.textContent = label;
      header.appendChild(time);
      card.appendChild(header);

      var body = document.createElement('div');
      body.className = 'slot-card-bd';
      if(ls.description){
        var desc = document.createElement('p');
        desc.className = 'slot-card-desc';
        desc.textContent = String(ls.description).slice(0, 60);
        body.appendChild(desc);
      }
      if(ls.price != null && ls.price !== ''){
        var price = document.createElement('p');
        price.className = 'slot-card-price';
        var num = Number(ls.price);
        if(!isNaN(num)) price.textContent = 'æ–™é‡‘ï¼šÂ¥' + num.toLocaleString() + 'ï¼ˆç¨è¾¼ï¼‰';
        else price.textContent = 'æ–™é‡‘ï¼š' + ls.price;
        body.appendChild(price);
      }
      card.appendChild(body);

      if(ls.color) card.style.borderLeft = '4px solid ' + ls.color;
      if(ls.hasNewCustomer){
        card.style.backgroundColor = '#fffbf0';
      }

      card.addEventListener('click', function(){
        if(typeof adminOpenSlotModalEdit === 'function') adminOpenSlotModalEdit(ls);
      });
      listEl.appendChild(card);
    });
  }

  function renderPackageList(){
    var listEl = adminState.dom.packageList;
    if(!listEl) return;
    listEl.innerHTML = '';
    var pkgs = adminState.packages.slice();
    if(pkgs.length === 0){
      var p = document.createElement('p');
      p.className = 'empty-text';
      p.textContent = 'ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
      listEl.appendChild(p);
      return;
    }
    pkgs.sort(function(a, b){
      var an = (a.lessonName || '');
      var bn = (b.lessonName || '');
      if(an < bn) return -1;
      if(an > bn) return 1;
      return 0;
    });
    pkgs.forEach(function(pkg){
      var card = document.createElement('div');
      card.className = 'package-card';
      var header = document.createElement('div');
      header.className = 'package-card-hd';
      var title = document.createElement('div');
      title.className = 'package-card-title';
      title.textContent = (pkg.lessonName || 'ãƒ¬ãƒƒã‚¹ãƒ³') + (pkg.teacherName ? ' ï¼ ' + pkg.teacherName : '');
      header.appendChild(title);
      if(pkg.price != null && pkg.price !== ''){
        var price = document.createElement('div');
        price.className = 'package-card-price';
        var num = Number(pkg.price);
        if(!isNaN(num)) price.textContent = 'Â¥' + num.toLocaleString() + 'ï¼ˆç¨è¾¼ï¼‰';
        else price.textContent = 'Â¥' + pkg.price;
        header.appendChild(price);
      }
      card.appendChild(header);
      var body = document.createElement('div');
      body.className = 'package-card-bd';
      if(pkg.description){
        var desc = document.createElement('p');
        desc.className = 'package-card-desc';
        desc.textContent = String(pkg.description).slice(0, 80);
        body.appendChild(desc);
      }
      card.appendChild(body);
      if(pkg.color) card.style.borderLeft = '4px solid ' + pkg.color;
      card.addEventListener('click', function(){ adminOpenPackageModalEdit(pkg); });
      listEl.appendChild(card);
    });
  }

  function renderCustomerList(){
    var ul = document.getElementById('customerListUL');
    var msg = document.getElementById('customerListMsg');
    if(!ul) return;
    
    ul.innerHTML = '<li class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</li>';
    if(msg) msg.style.display = 'none';
    gas('apiGetCustomerList')
      .then(function(list){
        adminState.customerList = Array.isArray(list) ? list : [];
        filterCustomerList(''); 
      })
      .catch(function(err){
        console.error(err);
        ul.innerHTML = '<li class="error-text">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</li>';
      });
  }

  function filterCustomerList(keyword){
    var ul = document.getElementById('customerListUL');
    var msg = document.getElementById('customerListMsg');
    if(!ul) return;
    
    ul.innerHTML = '';
    var list = adminState.customerList || [];
    var filtered = list;
    if(keyword){
      var kw = keyword.toLowerCase();
      filtered = list.filter(function(c){
        var txt = (c.name + ' ' + c.phone + ' ' + c.email).toLowerCase();
        return txt.indexOf(kw) > -1;
      });
    }

    if(filtered.length === 0){
      if(msg) {
        msg.textContent = keyword ? 'è©²å½“ã™ã‚‹é¡§å®¢ãŒã„ã¾ã›ã‚“' : 'é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“';
        msg.style.display = 'block';
      }
    } else {
      if(msg) msg.style.display = 'none';
      filtered.forEach(function(c){
        var li = document.createElement('li');
        li.className = 'guest-item';
        li.style.cursor = 'pointer';
        li.innerHTML = '<strong>' + (c.name || 'ï¼ˆåç§°æœªè¨­å®šï¼‰') + '</strong> æ§˜ <br>' +
                       '<span style="font-size:0.85em;color:#666;">æ¥åº—:' + (c.visitCount||0) + 'å› / Tel:' + (c.phone||'-') + '</span>';
        li.onclick = function(){
          openCustomerHistory(c);
        };
        ul.appendChild(li);
      });
    }
  }

  function openCustomerHistory(customer){
    var modal = document.getElementById('customerHistoryModal');
    var ul = document.getElementById('customerHistoryUL');
    var title = document.getElementById('historyCustomerName');
    if(title) title.textContent = (customer.name || 'ãŠå®¢æ§˜') + ' æ§˜ ã®å±¥æ­´';
    if(ul) ul.innerHTML = '<li class="loading-text">å±¥æ­´ã‚’èª­ã¿è¾¼ã¿ä¸­...</li>';
    if(modal) modal.style.display = 'flex';
    gas('apiGetCustomerHistory', { email: customer.email })
      .then(function(history){
        if(!ul) return;
        ul.innerHTML = '';
        if(!history || history.length === 0){
          ul.innerHTML = '<li class="empty-text">å±¥æ­´ãªã—</li>';
        } else {
          history.forEach(function(h){
            var li = document.createElement('li');
            li.className = 'guest-item';
            li.style.cursor = 'default';
            li.innerHTML = '<strong>' + h.date + ' ' + h.time + '</strong><br>' +
                           h.lessonName + ' <span style="font-size:0.8em;color:#888;">(' + h.status + ')</span>';
            ul.appendChild(li);
          });
        }
      })
      .catch(function(err){
        if(ul) ul.innerHTML = '<li class="error-text">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</li>';
      });
  }
  </script>

  <script>
  function adminOpenHelp(){
    var modal = document.getElementById('helpModal');
    if(modal) modal.style.display = 'flex';
  }
  function adminCloseHelp(){
    var modal = document.getElementById('helpModal');
    if(modal) modal.style.display = 'none';
  }

  var adminPackageState = {
    editingId: null
  };

  var ADMIN_PACKAGE_COLOR_PRESETS = [
    '#000000', '#FFFFFF', '#9E9E9E', '#FFD700', '#67C5B5', '#F48FB1', '#FFCC80', '#90CAF9', '#CE93D8', '#A5D6A7'
  ];

  function adminOpenPackageModalNew(){
    adminPackageState.editingId = null;
    var titleEl = document.getElementById('packageModalTitle');
    if(titleEl) titleEl.textContent = 'ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç™»éŒ²';
    setPackageModalFields({
      id: '',
      lessonName: '',
      teacherName: '',
      description: '',
      price: '',
      capacity: '',
      color: '#67C5B5'
    });
    var delBtn = document.getElementById('packageDeleteBtn');
    if(delBtn) delBtn.style.display = 'none';

    renderPackageColorPalette('#67C5B5');
    var modal = document.getElementById('packageModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminOpenPackageModalEdit(pkg){
    if(!pkg) return;
    adminPackageState.editingId = pkg.id || null;
    var titleEl = document.getElementById('packageModalTitle');
    if(titleEl) titleEl.textContent = 'ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç·¨é›†';
    
    setPackageModalFields(pkg);
    var delBtn = document.getElementById('packageDeleteBtn');
    if(delBtn) delBtn.style.display = '';

    var baseColor = pkg.color || '#67C5B5';
    renderPackageColorPalette(baseColor);
    var modal = document.getElementById('packageModal');
    if(modal) modal.style.display = 'flex';
  }

  function setPackageModalFields(pkg){
    (document.getElementById('packageId') || {}).value = pkg.id || '';
    (document.getElementById('packageLessonName') || {}).value = pkg.lessonName || '';
    (document.getElementById('packageTeacherName') || {}).value = pkg.teacherName || '';
    (document.getElementById('packageDescription') || {}).value = pkg.description || '';
    (document.getElementById('packagePrice') || {}).value = (pkg.price != null && pkg.price !== '') ? pkg.price : '';
    (document.getElementById('packageCapacity') || {}).value = (pkg.capacity != null && pkg.capacity !== '') ? pkg.capacity : '';
    (document.getElementById('packageColor') || {}).value = pkg.color || '#67C5B5';
  }

  function adminClosePackageModal(){
    var modal = document.getElementById('packageModal');
    if(modal) modal.style.display = 'none';
    adminPackageState.editingId = null;
  }

  function adminHandlePackageSave(){
    var idEl        = document.getElementById('packageId');
    var nameEl      = document.getElementById('packageLessonName');
    var teacherEl   = document.getElementById('packageTeacherName');
    var descEl      = document.getElementById('packageDescription');
    var priceEl     = document.getElementById('packagePrice');
    var capacityEl  = document.getElementById('packageCapacity');
    var colorEl     = document.getElementById('packageColor');

    var nameVal = nameEl ? (nameEl.value || '').trim() : '';
    if(!nameVal){
      alert('ãƒ¬ãƒƒã‚¹ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }

    var priceVal = priceEl ? (priceEl.value || '').trim() : '';
    var rawCap = capacityEl ? (capacityEl.value || '').trim() : '';
    var capacityVal = '';
    if(rawCap !== ''){
      var n = parseInt(rawCap, 10);
      if(isNaN(n) || n < 0) n = 0;
      capacityVal = String(n);
    }

    var colorVal = colorEl ? (colorEl.value || '').trim() : '';
    if(!colorVal) colorVal = '#67C5B5';
    var payload = {
      id:           idEl ? (idEl.value || '') : '',
      lessonName:   nameVal,
      teacherName:  teacherEl ? (teacherEl.value || '') : '',
      description:  descEl ? (descEl.value || '') : '',
      price:        priceVal,
      capacity:     capacityVal,
      color:        colorVal
    };
    gas('apiSavePackage', payload)
      .then(function(res){
        showToast('ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
        adminClosePackageModal();
        return gas('apiGetPackageList');
      })
      .then(function(pkgs){
        adminState.packages = Array.isArray(pkgs) ? pkgs : [];
        renderPackageList();
      })
      .catch(function(err){
        console.error(err);
      });
  }

  function adminHandlePackageDeleteClick(){
    var idEl = document.getElementById('packageId');
    var id = idEl ? (idEl.value || '') : '';
    if(!id){
      alert('å‰Šé™¤å¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }
    var modal = document.getElementById('packageDeleteModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminClosePackageDeleteModal(){
    var modal = document.getElementById('packageDeleteModal');
    if(modal) modal.style.display = 'none';
  }

  function adminHandlePackageDeleteConfirm(){
    var idEl = document.getElementById('packageId');
    var id = idEl ? (idEl.value || '') : '';
    if(!id){
      alert('å‰Šé™¤å¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }

    gas('apiDeletePackage', { id: id })
      .then(function(res){
        showToast('ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        adminClosePackageDeleteModal();
        adminClosePackageModal();
        return gas('apiGetPackageList');
      })
      .then(function(pkgs){
        adminState.packages = Array.isArray(pkgs) ? pkgs : [];
        renderPackageList();
      })
      .catch(function(err){
        console.error(err);
      });
  }

  function adminOpenPackageSelect(dateStr){
    if(!dateStr) return;
    adminState.selectedDate = dateStr;
    updateSelectedDateLabel();
    
    var dateLabel = document.getElementById('packageSelectDateLabel');
    if(dateLabel) dateLabel.textContent = formatDateLabel(dateStr) + ' ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ã€‚';
    var listEl = document.getElementById('packageSelectList');
    if(listEl){
      listEl.innerHTML = '';
      var pkgs = adminState.packages.slice();
      if(pkgs.length === 0){
        var p = document.createElement('p');
        p.className = 'empty-text';
        p.textContent = 'ç™»éŒ²ã§ãã‚‹ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ã€Œãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‹ã‚‰ä½œæˆã—ã¦ãã ã•ã„ã€‚';
        listEl.appendChild(p);
      }else{
        pkgs.sort(function(a, b){
          var an = (a.lessonName || '');
          var bn = (b.lessonName || '');
          if(an < bn) return -1;
          if(an > bn) return 1;
          return 0;
        });
        pkgs.forEach(function(pkg){
          var card = document.createElement('div');
          card.className = 'package-card package-card--select';

          var header = document.createElement('div');
          header.className = 'package-card-hd';
          var title = document.createElement('div');
          title.className = 'package-card-title';
          title.textContent = (pkg.lessonName || 'ãƒ¬ãƒƒã‚¹ãƒ³') + (pkg.teacherName ? ' ï¼ ' + pkg.teacherName : '');
          header.appendChild(title);

          if(pkg.price != null && pkg.price !== ''){
            var price = document.createElement('div');
            price.className = 'package-card-price';
            var num = Number(pkg.price);
            if(!isNaN(num)){
              price.textContent = 'Â¥' + num.toLocaleString() + 'ï¼ˆç¨è¾¼ï¼‰';
            }else{
              price.textContent = 'Â¥' + pkg.price;
            }
            header.appendChild(price);
          }

          card.appendChild(header);

          var body = document.createElement('div');
          body.className = 'package-card-bd';
          if(pkg.description){
            var desc = document.createElement('p');
            desc.className = 'package-card-desc';
            desc.textContent = String(pkg.description).slice(0, 80);
            body.appendChild(desc);
          }
          card.appendChild(body);
          if(pkg.color){
            card.style.borderLeft = '4px solid ' + pkg.color;
          }

          card.addEventListener('click', function(){
            adminHandlePackageChosen(pkg);
          });
          listEl.appendChild(card);
        });
      }
    }

    var modal = document.getElementById('packageSelectModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminClosePackageSelectModal(){
    var modal = document.getElementById('packageSelectModal');
    if(modal) modal.style.display = 'none';
  }

  function adminHandlePackageChosen(pkg){
    if(!pkg) return;
    adminClosePackageSelectModal();
    if(typeof adminOpenSlotModalNewWithPackage === 'function'){
      adminOpenSlotModalNewWithPackage(adminState.selectedDate, pkg);
    }
  }

  function renderPackageColorPalette(selectedColor){
    var hiddenInput = document.getElementById('packageColor');
    var palette = document.getElementById('packageColorPalette');
    if(!hiddenInput || !palette) return;

    var current = selectedColor || hiddenInput.value || '#67C5B5';
    palette.innerHTML = '';
    palette.style.display = 'flex';
    palette.style.flexWrap = 'wrap';
    palette.style.gap = '6px';
    palette.style.marginTop = '4px';
    
    ADMIN_PACKAGE_COLOR_PRESETS.forEach(function(col){
      var btn = document.createElement('button');
      btn.type = 'button';
      btn.style.width = '44px'; /* â˜…ä¿®æ­£: 66px -> 44px */
      btn.style.height = '44px';
      btn.style.borderRadius = '999px';
      btn.style.border = '1px solid rgba(0,0,0,0.25)';
      btn.style.padding = '0';
      btn.style.background = col;
      btn.style.cursor = 'pointer';
      btn.style.outline = 'none';
      btn.style.transition = 'transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease';

      if(col === current){
        btn.style.border = '2px solid #000000';
        btn.style.boxShadow = '0 0 0 2px rgba(0,0,0,0.25)';
        btn.style.transform = 'scale(1.1)';

        var mark = document.createElement('span');
        mark.className = 'color-check';
        mark.textContent = 'âœ“';
        mark.style.display = 'inline-block';
        mark.style.color = '#ffffff';
        mark.style.fontSize = '24px'; /* â˜…ä¿®æ­£: 42px -> 24px */
        mark.style.fontWeight = '700';
        mark.style.lineHeight = '44px';
        mark.style.textAlign = 'center';
        mark.style.width = '100%';
        mark.style.height = '100%';
        btn.appendChild(mark);
      }

      btn.addEventListener('click', function(){
        hiddenInput.value = col;

        var buttons = palette.querySelectorAll('button');
        buttons.forEach(function(b){
          b.style.border = '1px solid rgba(0,0,0,0.25)';
          b.style.boxShadow = 'none';
          b.style.transform = 'scale(1)';
          var m = b.querySelector('.color-check');
          if(m) b.removeChild(m);
        });

        btn.style.border = '2px solid #000000';
        btn.style.boxShadow = '0 0 0 2px rgba(0,0,0,0.25)';
        btn.style.transform = 'scale(1.1)';

        var mark = document.createElement('span');
        mark.className = 'color-check';
        mark.textContent = 'âœ“';
        mark.style.display = 'inline-block';
        mark.style.color = '#ffffff';
        mark.style.fontSize = '24px';
        mark.style.fontWeight = '700';
        mark.style.lineHeight = '44px';
        mark.style.textAlign = 'center';
        mark.style.width = '100%';
        mark.style.height = '100%';
        btn.appendChild(mark);
      });
      palette.appendChild(btn);
    });
  }

  document.addEventListener('DOMContentLoaded', function(){
    var pkgSaveBtn = document.getElementById('packageSaveBtn');
    if(pkgSaveBtn) pkgSaveBtn.addEventListener('click', adminHandlePackageSave);
    var pkgDeleteBtn = document.getElementById('packageDeleteBtn');
    if(pkgDeleteBtn) pkgDeleteBtn.addEventListener('click', adminHandlePackageDeleteClick);
    var pkgDeleteConfirmBtn = document.getElementById('packageDeleteConfirmBtn');
    if(pkgDeleteConfirmBtn) pkgDeleteConfirmBtn.addEventListener('click', adminHandlePackageDeleteConfirm);
  });
  </script>

  <script>
  var adminSlotState = {
    editingId: null,
    date: null,
    packageId: null,
    packageSummary: '',
    currentReservedCount: 0 
  };
  var ADMIN_COLOR_PRESETS = [
    '#000000', '#FFFFFF', '#9E9E9E', '#FFD700', '#67C5B5', '#F48FB1', '#FFCC80', '#90CAF9', '#CE93D8', '#A5D6A7'
  ];
  function adminOpenSlotModalNewWithPackage(dateStr, pkg){
    if(!dateStr || !pkg) return;

    adminSlotState.editingId = null;
    adminSlotState.date = dateStr;
    adminSlotState.packageId = pkg.id || '';
    adminSlotState.packageSummary = buildPackageSummary(pkg);
    adminSlotState.currentReservedCount = 0;

    (document.getElementById('slotId')||{}).value = '';
    (document.getElementById('slotDateLabel')||{}).textContent = formatDateLabel(dateStr);
    (document.getElementById('slotPackageSummary')||{}).textContent = adminSlotState.packageSummary;
    (document.getElementById('slotStartTime')||{}).value = '';
    (document.getElementById('slotEndTime')||{}).value = '';
    (document.getElementById('slotPrice')||{}).value = (pkg.price != null && pkg.price !== '') ? pkg.price : '';
    (document.getElementById('slotCapacity')||{}).value = (pkg.capacity != null && pkg.capacity !== '') ? pkg.capacity : '';
    (document.getElementById('slotColor')||{}).value = pkg.color || '#67C5B5';
    var delBtn = document.getElementById('slotDeleteBtn');
    if(delBtn) delBtn.style.display = 'none';

    var priceEl = document.getElementById('slotPrice');
    if(priceEl) {
      priceEl.disabled = false;
      priceEl.style.backgroundColor = '';
    }
    document.getElementById('priceLockMsg').style.display = 'none';
    document.getElementById('slotGuestSection').style.display = 'none';
    document.getElementById('slotGuestList').innerHTML = '';

    var titleEl = document.getElementById('slotModalTitle');
    if(titleEl) titleEl.textContent = 'ãƒ¬ãƒƒã‚¹ãƒ³æ ã®ç™»éŒ²';

    renderSlotColorPalette();
    var modal = document.getElementById('slotModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminOpenSlotModalEdit(lesson){
    if(!lesson) return;
    adminSlotState.editingId = lesson.id || null;
    adminSlotState.date = lesson.date || null;
    adminSlotState.packageId = lesson.packageId || '';
    adminSlotState.packageSummary = buildLessonSummary(lesson);
    adminSlotState.currentReservedCount = lesson.reservedCount || 0;

    (document.getElementById('slotId')||{}).value = lesson.id || '';
    (document.getElementById('slotDateLabel')||{}).textContent = formatDateLabel(lesson.date);
    (document.getElementById('slotPackageSummary')||{}).textContent = adminSlotState.packageSummary;
    (document.getElementById('slotStartTime')||{}).value = lesson.startTime || '';
    (document.getElementById('slotEndTime')||{}).value = lesson.endTime || '';
    (document.getElementById('slotPrice')||{}).value = (lesson.price != null && lesson.price !== '') ? lesson.price : '';
    (document.getElementById('slotCapacity')||{}).value = (lesson.capacity != null && lesson.capacity !== '') ? lesson.capacity : '';
    (document.getElementById('slotColor')||{}).value = lesson.color || '#67C5B5';
    var delBtn = document.getElementById('slotDeleteBtn');
    if(delBtn) {
      if(adminSlotState.currentReservedCount > 0) {
        delBtn.style.display = 'none';
      } else {
        delBtn.style.display = ''; 
      }
    }

    var titleEl = document.getElementById('slotModalTitle');
    if(titleEl) titleEl.textContent = 'ãƒ¬ãƒƒã‚¹ãƒ³æ ã®ç·¨é›†';

    renderSlotColorPalette();

    var priceEl = document.getElementById('slotPrice');
    var lockMsg = document.getElementById('priceLockMsg');
    if(priceEl && lockMsg){
      if(adminSlotState.currentReservedCount > 0){
        priceEl.disabled = true;
        priceEl.style.backgroundColor = '#f0f0f0';
        lockMsg.style.display = 'inline';
      } else {
        priceEl.disabled = false;
        priceEl.style.backgroundColor = '';
        lockMsg.style.display = 'none';
      }
    }

    var guestSec = document.getElementById('slotGuestSection');
    var guestList = document.getElementById('slotGuestList');
    guestSec.style.display = 'block';
    guestList.innerHTML = '<li class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</li>';
    gas('apiGetSlotGuests', lesson.id)
      .then(function(guests){
        guestList.innerHTML = '';
        if(!guests || guests.length === 0){
          guestList.innerHTML = '<li class="empty-text">äºˆç´„ãªã—</li>';
        } else {
          guests.forEach(function(g){
            var li = document.createElement('li');
            li.className = 'guest-item';
            li.style.cursor = 'pointer';
            li.onclick = function() { adminOpenGuestDetailModal(g); };
            
            var mark = '';
            var vc = Number(g.visitCount || 0);
            if(vc <= 1) {
              mark = ' <span style="font-size:1.0em;">ğŸ”°</span>';
            }

            li.innerHTML = '<strong>' + g.name + '</strong>' + mark + ' æ§˜ <br><span style="font-size:0.85em;color:#666;">' + (g.phone || 'é›»è©±ãªã—') + '</span>';
            guestList.appendChild(li);
          });
        }
      })
      .catch(function(e){
        guestList.innerHTML = '<li class="error-text">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</li>';
      });
    var modal = document.getElementById('slotModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminOpenGuestDetailModal(guest){
    (document.getElementById('guestName')||{}).value = guest.name || '';
    (document.getElementById('guestPhone')||{}).value = guest.phone || '';
    (document.getElementById('guestEmail')||{}).value = guest.email || '';
    
    (document.getElementById('guestVisitCount')||{}).value = (guest.visitCount != null) ? guest.visitCount + ' å›' : '0 å›';
    (document.getElementById('guestCustomerId')||{}).value = guest.customerId || '-';
    (document.getElementById('guestMemo')||{}).value = guest.memo || '';
    var btnHistory = document.getElementById('btnGuestHistoryFromDetail');
    if(btnHistory){
      btnHistory.onclick = function(){
        adminCloseGuestDetailModal();
        if(typeof openCustomerHistory === 'function'){
          openCustomerHistory(guest);
        } else {
          alert('å±¥æ­´æ©Ÿèƒ½ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };
    }
    
    var modal = document.getElementById('guestDetailModal');
    if(modal) modal.style.display = 'flex';
  }

  function adminCloseGuestDetailModal(){
    var modal = document.getElementById('guestDetailModal');
    if(modal) modal.style.display = 'none';
  }

  function buildPackageSummary(pkg){
    var parts = [];
    var title = (pkg.lessonName || 'ãƒ¬ãƒƒã‚¹ãƒ³');
    if(pkg.teacherName) title += ' ï¼ ' + pkg.teacherName;
    parts.push(title);
    if(pkg.price != null && pkg.price !== ''){
      var num = Number(pkg.price);
      if(!isNaN(num)){
        parts.push('æ–™é‡‘ï¼šÂ¥' + num.toLocaleString() + 'ï¼ˆç¨è¾¼ï¼‰');
      }else{
        parts.push('æ–™é‡‘ï¼š' + pkg.price);
      }
    }
    return parts.join('ã€€');
  }

  function buildLessonSummary(ls){
    var parts = [];
    var title = (ls.lessonName || 'ãƒ¬ãƒƒã‚¹ãƒ³');
    if(ls.teacherName) title += ' ï¼ ' + ls.teacherName;
    parts.push(title);
    if(ls.price != null && ls.price !== ''){
      var num = Number(ls.price);
      if(!isNaN(num)){
        parts.push('æ–™é‡‘ï¼šÂ¥' + num.toLocaleString() + 'ï¼ˆç¨è¾¼ï¼‰');
      }else{
        parts.push('æ–™é‡‘ï¼š' + ls.price);
      }
    }
    return parts.join('ã€€');
  }

  function adminCloseSlotModal(){
    var modal = document.getElementById('slotModal');
    if(modal) modal.style.display = 'none';
    adminSlotState.editingId = null;
    adminSlotState.date = null;
    adminSlotState.packageId = null;
    adminSlotState.packageSummary = '';
  }

  function adminOpenSlotDeleteModal(){
    var modal = document.getElementById('slotDeleteModal');
    if(modal) modal.style.display = 'flex';
  }
  function adminCloseSlotDeleteModal(){
    var modal = document.getElementById('slotDeleteModal');
    if(modal) modal.style.display = 'none';
  }

  function adminHandleSlotSave(){
    var dateStr = adminSlotState.date || adminState.selectedDate;
    if(!dateStr){ alert('æ—¥ä»˜ãŒä¸æ˜ã§ã™ã€‚'); return; }
    if(!adminSlotState.packageId){ alert('ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚'); return; }

    var startEl = document.getElementById('slotStartTime');
    var endEl   = document.getElementById('slotEndTime');
    var colorEl = document.getElementById('slotColor');
    var priceEl = document.getElementById('slotPrice');
    var capEl   = document.getElementById('slotCapacity');
    var idEl    = document.getElementById('slotId');

    var startVal    = startEl ? (startEl.value || '').trim() : '';
    var endVal      = endEl   ? (endEl.value   || '').trim() : '';
    var colorVal    = colorEl ? (colorEl.value || '').trim() : '';
    var priceVal    = priceEl ? (priceEl.value || '').trim() : '';
    var capacityVal = capEl   ? (capEl.value   || '').trim() : '';

    if(!startVal){ alert('é–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
    if(!endVal){ alert('çµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

    if(capacityVal !== ''){
      var newCap = parseInt(capacityVal, 10);
      if(adminSlotState.currentReservedCount > 0 && newCap < adminSlotState.currentReservedCount){
        alert('ã‚¨ãƒ©ãƒ¼ï¼šç¾åœ¨ã®äºˆç´„æ•°(' + adminSlotState.currentReservedCount + 'å)ã‚ˆã‚Šå°‘ãªã„å®šå“¡ã«ã¯å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚');
        return;
      }
    }

    var payload = {
      id:        idEl ? (idEl.value || '') : '',
      date:      dateStr,
      startTime: startVal,
      endTime:   endVal,
      packageId: adminSlotState.packageId,
      color:     colorVal,
      price:     priceVal,
      capacity:  capacityVal
    };
    gas('apiAdminSaveSlot', payload)
      .then(function(res){
        showToast('ãƒ¬ãƒƒã‚¹ãƒ³æ ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
        adminCloseSlotModal();
        return gas('apiGetAdminInit');
      })
      .then(function(data){
        if(data){
          adminState.today    = data.today || adminState.today;
          adminState.lessons  = Array.isArray(data.lessons)  ? data.lessons  : [];
          adminState.packages = Array.isArray(data.packages) ? data.packages : adminState.packages;
        }
        renderMonth();
        updateSelectedDateLabel();
        renderSlotListForSelectedDate();
        renderPackageList();
      })
      .catch(function(err){
        console.error(err);
        alert(err.message); 
      });
  }

  function adminHandleSlotDeleteClick(){
    if(!adminSlotState.editingId){ alert('å‰Šé™¤å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'); return; }
    adminOpenSlotDeleteModal();
  }

  function adminHandleSlotDeleteConfirm(){
    if(!adminSlotState.editingId) return;
    var id = adminSlotState.editingId;
    gas('apiAdminDeleteSlot', { id: id })
      .then(function(res){
        showToast('ãƒ¬ãƒƒã‚¹ãƒ³æ ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        adminCloseSlotDeleteModal();
        adminCloseSlotModal();
        return gas('apiGetAdminInit');
      })
      .then(function(data){
        if(data){
          adminState.today    = data.today || adminState.today;
          adminState.lessons  = Array.isArray(data.lessons)  ? data.lessons  : [];
          adminState.packages = Array.isArray(data.packages) ? data.packages : adminState.packages;
        }
        renderMonth();
        updateSelectedDateLabel();
        renderSlotListForSelectedDate();
        renderPackageList();
      })
      .catch(function(err){
        console.error(err);
      });
  }

  function renderSlotColorPalette(){
    var colorInput = document.getElementById('slotColor');
    if(!colorInput) return;

    var existing = document.getElementById('slotColorPalette');
    if(existing && existing.parentNode) existing.parentNode.removeChild(existing);
    var parent = colorInput.parentElement;
    if(!parent) return;

    var palette = document.createElement('div');
    palette.id = 'slotColorPalette';
    palette.style.display = 'flex';
    palette.style.flexWrap = 'wrap';
    palette.style.gap = '6px';
    palette.style.marginTop = '4px';

    var current = colorInput.value || '#67C5B5';
    ADMIN_COLOR_PRESETS.forEach(function(col){
      var btn = document.createElement('button');
      btn.type = 'button';
      btn.style.width = '44px'; /* â˜…ä¿®æ­£: 66px -> 44px */
      btn.style.height = '44px';
      btn.style.borderRadius = '999px';
      btn.style.border = '1px solid rgba(0,0,0,0.25)';
      btn.style.padding = '0';
      btn.style.background = col;
      btn.style.cursor = 'pointer';
      btn.style.outline = 'none';
      btn.style.transition = 'transform 0.1s ease, box-shadow 0.1s ease';

      if(col === current){
        btn.style.border = '2px solid #000000';
        btn.style.boxShadow = '0 0 0 2px rgba(0,0,0,0.25)';
        btn.style.transform = 'scale(1.1)';
        var mark = document.createElement('span');
        mark.className = 'color-check';
        mark.textContent = 'âœ“';
        mark.style.display = 'inline-block';
        if(col.toLowerCase() === '#ffffff' || col.toLowerCase() === '#fff'){
          mark.style.color = '#000000';
        } else {
          mark.style.color = '#ffffff';
        }
        mark.style.fontSize = '24px'; /* â˜…ä¿®æ­£: 42px -> 24px */
        mark.style.fontWeight = '700';
        mark.style.lineHeight = '44px';
        mark.style.textAlign = 'center';
        mark.style.width = '100%';
        mark.style.height = '100%';
        btn.appendChild(mark);
      }

      btn.addEventListener('click', function(){
        colorInput.value = col;
        var buttons = palette.querySelectorAll('button');
        buttons.forEach(function(b){
          b.style.border = '1px solid rgba(0,0,0,0.25)';
          b.style.boxShadow = 'none';
          b.style.transform = 'scale(1)';
          var m = b.querySelector('.color-check');
          if(m) b.removeChild(m);
        });
        btn.style.border = '2px solid #000000';
        btn.style.boxShadow = '0 0 0 2px rgba(0,0,0,0.25)';
        btn.style.transform = 'scale(1.1)';
        var mark = document.createElement('span');
        mark.className = 'color-check';
        mark.textContent = 'âœ“';
        mark.style.display = 'inline-block';
        
        if(col.toLowerCase() === '#ffffff' || col.toLowerCase() === '#fff'){
          mark.style.color = '#000000';
        } else {
          mark.style.color = '#ffffff';
        }
        
        mark.style.fontSize = '24px';
        mark.style.fontWeight = '700';
        mark.style.lineHeight = '44px';
        mark.style.textAlign = 'center';
        mark.style.width = '100%';
        mark.style.height = '100%';
        btn.appendChild(mark);
      });
      palette.appendChild(btn);
    });
    parent.appendChild(palette);
  }

  document.addEventListener('DOMContentLoaded', function(){
    var saveBtn = document.getElementById('slotSaveBtn');
    if(saveBtn) saveBtn.addEventListener('click', adminHandleSlotSave);
    var delBtn = document.getElementById('slotDeleteBtn');
    if(delBtn) delBtn.addEventListener('click', adminHandleSlotDeleteClick);
    var delConfirmBtn = document.getElementById('slotDeleteConfirmBtn');
    if(delConfirmBtn) delConfirmBtn.addEventListener('click', adminHandleSlotDeleteConfirm);

    var guestModal = document.getElementById('guestDetailModal');
    if(guestModal){
      guestModal.addEventListener('click', function(e){
        if(e.target === guestModal){
          adminCloseGuestDetailModal();
        }
      });
    }
  });
  </script>
</body>
</html>